Tunnel-SSH
==========

![Tunnel-SSH Logo](http://i.imgur.com/I5PRnDD.jpg)

Tunnel-SSH - v3.0.0-BETA

This package is ```ssh user@remote -L 2000:localhost:27017``` the node way.

## THIS IS A BETA RELEASE - THX for Testing and providing feedback

* Easy to setup
* Easy to integrate
* Can do reverse tunnel
* Automatic connection handling for your cli scripts.
 


## Changes from 2.0.x
* Promise api
* Reusing SSH Connection for faster Pooling or mass connections.
* New option timeout
* "patchNet" - API (@see below) 


## Fast lane 
The most common case is to tunnel a remote database via port mapping.
The following example creates a tunnel to a remote database.

    var tunnel = require('tunnel-ssh');
    var config = {
        username:'root',
        password:'secret',
        host:'remote.mysql.server.com',
        port:3306
    }
    
    tunnel(config, function(e, sshTunnel){
        //Now, you should be able to connect to the tunnel via localhost:3336.
    });


## Configuration

    var config = {
    
        username:'root', 
        // ssh username used to connect to the sshServer
        // default: current user, fallback root
        
        password:'secret', 
        // ssh password to connect to the sshServer
        // if you plan to use private keys you don't need a password.
        
        privateKey:'/Users/[username]/.ssh/id_rsa'
        // ssh key to use for the sshServer
        // Optional. no default 
        
        agent:'/private/tmp/com.apple.launchd.wTs9rJUSK4/Listeners'
        // ssh-agent socket path used to connect to the sshServer
        // default: process.env['SSH_AUTH_SOCK']
        
        srcHost:'localhost', 
        // the Host we tunnel from (interpreted from local machine).
        // So localhost means this machine.
        // Default 127.0.0.1
        
        srcPort: '27017' 
        // The port we tunnel from 
        // Alias: Port
        // Default: autogenerated by finding a free port 
        
        host:'remote.mysql.server.com', 
         // Hostname or IP to connect to the sshserver  
         // Default: 127.0.0.1
         // Alias: sshHost
        
        sshHost:'remote.mysql.server.com', 
        // Hostname or IP to connect to the sshserver  
        // Default: 127.0.0.1
        // Alias: host
        
        sshPort:22, 
        // Port to connect to the sshserver
        // Default: 22
        
        dstHost:'localhost', 
        // Hind: dst means destination here
        // Hostname to tunnel to (interpreted by sshHost) 
        // default: '127.0.0.1' (same as sshHost)
        
        dstPort: '27017',
        // Hind: dst means destination here
        // The port to tunnel to. 
        // Required !
        // Alias: port
        
        port:3306 
        // Alias for src- and dstPort
        // Used to simple map a remote service to 
		// a localhost without remapping the port.
        
        shutdown:
        
        keepAlive:false
        // deprecated 
        // 
        // keepAlive will keep the tunnel open even if no connection is left. 
        // This can be used if you want a classic tunnel for external tools
        // like (navicat, mongoshell)
        // to close the tunnel you need to manually call "tunnel.close()
        // default: false;
        
        timeout:1000
        // KeepAlive for 1 second, countdown starts if no connection is left 
        // Example: If you set the timer for 2 seconds and reconnect every 
        // second to the tunnel  
        // The tunnel will stay open.
        // default: not set
    }


from the first example looks like you setting up a configuration 
 for one host, but 
Source
Destination
SSH

The configuration is based on the original SSH2 configuration, since v3
we put some sugar into the config, so the following convention can be used: 

if a hostname is not set (srcHost, dstHost, host) then the hostname will be 127.0.0.1 (localhost).



Pro tip: 
If you plan to expose a local port on a remote machine you need to
enable the "GatewayPorts" option in your 'sshd_config'

    #What ports, IPs and protocols we listen for
    Port 22
    GatewayPorts yes
    


####map remote port to localhost:
```js
    var tunnel = require('tunnel-ssh');
    //map port from remote 3306 to localhost 3306
    var server = tunnel({host: '172.16.0.8', dstPort: 3306}, function (error, result) {
        //you can start using your resources here. (mongodb, mysql, ....)
        console.log('connected');
    });
```

####remap remote port to localhost
```js
    // add a localPort for more more control
    var config = {
        host: '172.16.0.8',
        username: 'root',
        dstPort: 3306,
        localPort: 3000
    };
    
    var server = tunnel(config, function (error, result) {
        console.log('connected');
    });
```

You can find more examples here 



tunnel-ssh supports the default ssh2 configuration.
```js
    {
        username: 'root',
        port: 22,
        srcPort: 0,
        srcHost: 'localhost',
        dstPort: null,
        dstHost: 'localhost',
        agent : process.env.SSH_AUTH_SOCK,
        privateKey:require('fs').readFileSync('/here/is/my/key'),
        password:'secret'
    } `
```
